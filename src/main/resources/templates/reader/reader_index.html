<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>åœ¨çº¿å€Ÿé˜…å¹³å°</title>

    <style>
        .my-big-title{
            height: 60px; line-height: 60px; font-size: 24px; padding-left: 30px;
        }
        .my-nav{
            float: right;
        }
        .my-main-body{
            color: #898989; font-size: 16px; margin: 30px
        }
        .welcome-container {
            padding: 20px;
        }
        .stat-card {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
            margin-bottom: 20px;
            text-align: center;
        }
        .stat-card h3 {
            color: #666;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .stat-card h2 {
            color: #333;
            font-size: 36px;
            font-weight: bold;
        }
        .chart-container {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
            margin-bottom: 20px;
            height: 400px;
            width: 100%;
        }
        .quick-nav {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .quick-nav-item {
            text-align: center;
            padding: 20px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
            transition: all 0.3s;
            width: 22%;
        }
        .quick-nav-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,.2);
        }
        .quick-nav-icon {
            font-size: 36px;
            margin-bottom: 10px;
            color: #009688;
        }
        .quick-nav-title {
            font-size: 16px;
            color: #333;
        }
        /* è½®æ’­å›¾æ ·å¼ */
        .carousel-container {
            margin: 20px 0;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
        }
        .carousel-item {
            height: 300px;
            background-size: cover;
            background-position: center;
        }
        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* å…¬å‘Šæ æ ·å¼ */
        .notice-container {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
            margin-bottom: 20px;
        }
        .notice-title {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .notice-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .notice-item {
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }
        .notice-item:last-child {
            border-bottom: none;
        }
        .notice-item-title {
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }
        .notice-item-content {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }
        .notice-item-time {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
    </style>

    <!-- å¯¼å…¥layui css -->
    <link rel="stylesheet" href="../layuimini/lib/layui-v2.6.3/css/layui.css" media="all">
    <!-- å¯¼å…¥echarts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- å¯¼å…¥layui js -->
    <script src="../layuimini/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
</head>
<body>
<div class="layui-container">
    <div class="layui-row" style="background-color: #009688; color: white">
        <div class="layui-col-md5 my-big-title">
            <img src="http://localhost:8092/BookManager/pictures/logo.png" style="height: 45px">
            å›¾ä¹¦ç®¡ç†ç³»ç»Ÿâ€”åœ¨çº¿å€Ÿé˜…å¹³å°
        </div>
        <div class="layui-col-md7">
            <ul class="layui-nav layui-bg-green my-nav">
                <li class="layui-nav-item layui-this">
                    <a href="./reader_index.html">é¦–é¡µ</a>
                </li>
                <li class="layui-nav-item">
                    <a href="./reader_book_list.html">å…¨éƒ¨å›¾ä¹¦</a>
                </li>
                <li class="layui-nav-item">
                    <a href="./reader_book_classification.html">å›¾ä¹¦åˆ†ç±»</a>
                </li>
                <li class="layui-nav-item">
                    <a href="./reader_borrow.html">æˆ‘çš„å€Ÿé˜…</a>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;" id="my-about">å…³äº</a>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;"><span id="my_name">æœªç™»å½•</span></a>
                    <dl class="layui-nav-child">
                        <dd><a href="./reader_password.html">ä¿®æ”¹å¯†ç </a></dd>
                        <dd><a href="javascript:;" id="login-out">é€€å‡ºç™»å½•</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>

    <!-- è½®æ’­å›¾ -->
    <div class="carousel-container">
        <div class="layui-carousel" id="carousel">
            <div carousel-item>
                <div class="carousel-item">
                    <img src="http://localhost:8092/BookManager/pictures/banner1.jpg" alt="banner1">
                </div>
                <div class="carousel-item">
                    <img src="http://localhost:8092/BookManager/pictures/banner2.jpg" alt="banner2">
                </div>
                <div class="carousel-item">
                    <img src="http://localhost:8092/BookManager/pictures/banner3.jpg" alt="banner3">
                </div>
            </div>
        </div>
    </div>

    <div class="welcome-container">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md3">
                <div class="stat-card">
                    <h3>æ€»å€Ÿé˜…é‡</h3>
                    <h2 id="total-borrows">0</h2>
                </div>
            </div>
            <div class="layui-col-md3">
                <div class="stat-card">
                    <h3>å½“å‰å€Ÿé˜…</h3>
                    <h2 id="current-borrows">0</h2>
                </div>
            </div>
            <div class="layui-col-md3">
                <div class="stat-card">
                    <h3>å·²è¿˜å›¾ä¹¦</h3>
                    <h2 id="returned-books">0</h2>
                </div>
            </div>
            <div class="layui-col-md3">
                <div class="stat-card">
                    <h3>é€¾æœŸæ¬¡æ•°</h3>
                    <h2 id="overdue-times">0</h2>
                </div>
            </div>
        </div>

        <!-- å¿«é€Ÿå¯¼èˆª -->
        <div class="layui-row">
            <div class="layui-col-md12">
                <div class="stat-card">
                    <div class="quick-nav">
                        <a href="./reader_book_list.html" class="quick-nav-item">
                            <div class="quick-nav-icon">ğŸ“š</div>
                            <div class="quick-nav-title">å…¨éƒ¨å›¾ä¹¦</div>
                        </a>
                        <a href="./reader_book_classification.html" class="quick-nav-item">
                            <div class="quick-nav-icon">ğŸ“–</div>
                            <div class="quick-nav-title">å›¾ä¹¦åˆ†ç±»</div>
                        </a>
                        <a href="./reader_borrow.html" class="quick-nav-item">
                            <div class="quick-nav-icon">ğŸ“</div>
                            <div class="quick-nav-title">æˆ‘çš„å€Ÿé˜…</div>
                        </a>
                        <a href="./reader_password.html" class="quick-nav-item">
                            <div class="quick-nav-icon">ğŸ”’</div>
                            <div class="quick-nav-title">ä¿®æ”¹å¯†ç </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="notice-container">
                    <div class="notice-title">ğŸ“¢ ç³»ç»Ÿå…¬å‘Š</div>
                    <ul class="notice-list" id="notice-list">
                        <!-- å…¬å‘Šå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- æœ€è¿‘å€Ÿé˜…è®°å½• -->
        <div class="layui-row">
            <div class="layui-col-md12">
                <div class="stat-card">
                    <h3>æœ€è¿‘å€Ÿé˜…è®°å½•</h3>
                    <table class="layui-table" lay-filter="recentBorrows">
                        <thead>
                        <tr>
                            <th>ä¹¦å</th>
                            <th>å€Ÿé˜…æ—¶é—´</th>
                            <th>åº”è¿˜æ—¶é—´</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                        </thead>
                        <tbody id="recent-borrows-list">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    layui.use(['form', 'layer', 'carousel'], function(){
        var form = layui.form,
            layer = layui.layer,
            carousel = layui.carousel,
            $ = layui.$;

        // è½®æ’­å›¾åˆå§‹åŒ–
        carousel.render({
            elem: '#carousel',
            width: '100%',
            height: '300px',
            arrow: 'always',
            anim: 'fade',
            interval: 3000
        });

        var objUserid;
        $.ajax({
            url: '../user/reader/getUser',
            type: 'post',
            datatype: 'json',
            success: function (userObj) {
                $("#my_name").text(userObj.username);
                objUserid = userObj.userid;
                loadStatistics(objUserid);
                loadCharts(objUserid);
                loadRecentBorrows(objUserid);
            }
        });

        $('#login-out').on("click", function () {
            $.ajax({
                url: '../user/reader/exitLogin',
                type: 'get',
                success: function () {
                    layer.msg('é€€å‡ºç™»å½•æˆåŠŸ', {time:1000}, function () {
                        window.location = '../index.html';
                    });
                }
            });
        });

        $('#my-about').on("click", function () {
            layer.open({
                title: 'å…³äºä¿¡æ¯',
                content: 'ç³»ç»Ÿåç§°ï¼šå›¾ä¹¦ç®¡ç†ç³»ç»Ÿ<br>ä½œè€…ï¼šç‹ç‘ æç« é’¥ åˆ˜æ¹˜æ¹˜<br>Babyæˆ‘ä»¬çš„æ„Ÿæƒ…å°±åƒè·³æ¥¼æœº',
                end: function () {
                    location.reload();
                }
            });
        });

        function loadStatistics(userid) {
            $.ajax({
                url: '../borrow/reader/getStatistics',
                type: 'get',
                data: {userid: userid},
                success: function(res) {
                    $('#total-borrows').text(res.totalBorrows || 0);
                    $('#current-borrows').text(res.currentBorrows || 0);
                    $('#returned-books').text(res.returnedBooks || 0);
                    $('#overdue-times').text(res.overdueTimes || 0);
                }
            });
        }

        function loadCharts(userid) {
            // åŠ è½½å…¬å‘Š
            $.ajax({
                url: '../notice/reader/getNotices',
                type: 'get',
                success: function(res) {
                    var html = '';
                    res.forEach(function(notice) {
                        html += '<li class="notice-item">' +
                            '<div class="notice-item-title">' + notice.title + '</div>' +
                            '<div class="notice-item-content">' + notice.content + '</div>' +
                            '<div class="notice-item-time">å‘å¸ƒæ—¶é—´ï¼š' + notice.createTime + '</div>' +
                            '</li>';
                    });
                    $('#notice-list').html(html);
                }
            });
        }

        function loadRecentBorrows(userid) {
            $.ajax({
                url: '../borrow/reader/getRecentBorrows',
                type: 'get',
                data: {userid: userid},
                success: function(res) {
                    var html = '';
                    res.forEach(function(item) {
                        var status = item.status === 'å·²è¿˜' ? 
                            '<span class="layui-badge layui-bg-green">å·²è¿˜</span>' : 
                            '<span class="layui-badge layui-bg-orange">å€Ÿé˜…ä¸­</span>';
                        html += '<tr>' +
                            '<td>' + item.bookname + '</td>' +
                            '<td>' + item.borrowtime + '</td>' +
                            '<td>' + item.returntime + '</td>' +
                            '<td>' + status + '</td>' +
                            '</tr>';
                    });
                    $('#recent-borrows-list').html(html);
                }
            });
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç»˜å›¾è¡¨
        window.addEventListener('resize', function() {
            echarts.init(document.getElementById('book-categories')).resize();
        });
    });
</script>
</body>
</html> 